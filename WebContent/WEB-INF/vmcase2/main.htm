<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0040)http://172.17.0.27:8080/sample/main.page -->
<html xmlns="http://www.w3.org/1999/xhtml" class="hb-loaded">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="${uicasePath}/css/css.css" />
<link rel="stylesheet" type="text/css"
	href="${uicasePath}/css/jquery-ui-1.10.3.custom.css" />
<script type="text/javascript"
	src="${contextPath}/common/js/common/json2.js"></script>
<script src='${contextPath}/common/js/common/jquery.min.js'></script>
<script
	src="${contextPath}/common/js/common/jquery-ui-1.10.3.custom.min.js"></script>
<script src="${contextPath}/common/js/common/common.js"></script>
<script src="${contextPath}/common/js/common/dialog.js"></script>
<script src='${contextPath}/common/js/common/lhgcalendar.js'></script>
<script type="text/javascript"
	src="${uicasePath}/js/common/windowInfo.js"></script>
<script type="text/javascript" src="${uicasePath}/js/common/menu.js"></script>
<title>#i18n("window.title")</title>
<style type="text/css">
	#ltjl{background: #1c1c1c; width:300px; position: fixed; right:-300px; top:0px; bottom: 0px;}
	#ltjl .pull-right{cursor:pointer;width:15px;height:75px;position:absolute;top:50%;margin-top:-37.5px;z-index:100;}
	#ltjl .pull-right img{height:13px;margin-left:1px;margin-top:30px;}
	#ltjl h1{color:#fff;font-size:16px;padding-top:10px;padding-left:30px;}
	#ltjl h1 .fanye{width:50px;height:20px;line-height:20px;font-family:"Microsoft YaHei";cursor:pointer;}
	/*.jlSearch{width:275px;height:40px;position:absolute;left:15px;right:10px;top:40px;background:#000;}
	.jlSearch input{width:235px;height:40px;border:none;color:#fff;background:#4d4d4d;font-size:14px;line-height:40px;padding-left:5px;}
	.jlSearch input:hover,.jlSearch input:focus{border:none;}
	.jlSearch span{cursor:pointer;position:absolute;left:235px;width:40px;height:40px;background:#4d4d4d url(${uicasePath}/images/search.png) no-repeat right center;}*/
	
	
	.spjl{background:#2e2e2e;width:275px;position:absolute;top:40px;left:15px;bottom:100px;right:10px;overflow:auto;}
	.spjl div{width:90%;margin:0 auto;padding:5px;border-bottom:1px dashed #1c1c1c;}
	.spjl p{color:#a9a9a9;}
	.spjl .own p{text-align:right;color:#fff;}
	.spjl p img{height:25px;width:25px;}
	
	
	.fb{width:275px;height:80px;position:absolute;left:15px;right:10px;bottom:10px;}
	.fb textarea{width:270px;resize:none;height:50px;border:none;color:#fff;font-family:"Microsoft YaHei";background:#626262;font-size:13px;padding-left:5px;}
	.fb input:hover,.jlSearch input:focus{border:none;}
	.fb span{cursor:pointer;position:absolute;right:0px;width:91px;height:30px;background:#e73c32;color:#e5e5e5;line-height:30px;text-align:center;}
	/*a  upload */
	.image {width:90px;height:30px;position: relative; margin-right:2px;cursor: pointer;background:#3a3a3a url(${uicasePath}/images/sctp.png) no-repeat center;overflow: hidden;display: inline-block;*display: inline;*zoom: 1}
	.image:hover {background-image:url(${uicasePath}/images/sctp_h.png);}
	.music{background-image:url(${uicasePath}/images/scyp.png);}
	.music:hover{background-image:url(${uicasePath}/images/scyp_h.png);}
	
	#scDiv{position:absolute;right:10px;left:15px;bottom:90px;height:300px;background:#3a3a3a;padding:12px;display:none;}
	#scDiv input{color:#939393;padding:10px;}
	#scDiv .image {width:50px;height:50px;margin-bottom:5px;position: relative; margin-right:2px;cursor: pointer;background:#000 url(${uicasePath}/images/sctp.png) no-repeat center;overflow: hidden;display: inline-block;*display: inline;*zoom: 1}
	#scDiv .image img{width:50px;height:50px;}
	#scDiv .image input {position: absolute;font-size: 100px;right: 0;top: 0;opacity: 0;filter: alpha(opacity=0);cursor: pointer}
	#scDiv #yp .image{background-image:url(${uicasePath}/images/scyp.png)}
	
	.mydialog{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);text-align:center;display:none;}
	.mydialog img{margin-top:5%;height:75%;}
	.mydialog .close{width:80px;height:30px;line-height:30px;font-family:"Microsoft YaHei";cursor:pointer;}
	
	
	.dialog{width:100%;height:100%;position:fixed;top:0;z-index:1000000;display:none;}
	.dialog .background{position:absolute;width:100%;height:100%;background:rgba(0, 0, 0, 0.5)!important;filter:Alpha(opacity=50); background:#000;}
	.dialog .dialog-box{position:relative;width:30em;background:#ffffff;margin:0 auto;margin-top:7%;}
	.dialog-box .dialog-content{padding:15px;line-height:35px;text-align:center;margin-bottom:20px;}
	
	.dialog-box h5{background: #0a55c8;border-bottom: 1px dotted #c0c0c0;border-bottom:1px dotted rgba(0, 0, 0, 0.2);padding: 15px;text-transform: uppercase;color: #fff;font-size: 16px;font-weight:normal;}
	.dialog-box .closebtn{display:inline-block;margin:10px;width:25px;height:25px;cursor:pointer;float:right;margin-top:-38px;background:url(${uicasePath}/images/close.png) no-repeat;}
	.dialog-box .closebtn:hover{background:url(${uicasePath}/images/close_a.png) no-repeat;}
	.dialog-box h5 img{vertical-align:middle;}
	.dialog-box .report{width:100%;float:none;overflow:auto;}	
	.dialog-box .button{margin-bottom:20px;}
	.dialog-box input[type=text]{border:1px solid #65cea7;box-shadow:0px 0px 5px #65cea7;border-radius:5px;outline:none;box-shadow:none;height: 20px;padding: 4px 6px;font-size: 14px;line-height: 20px;color: #555555;vertical-align: middle;}
	/*滚动条样式*/
	.dialog-box .report::-webkit-scrollbar{width:3px;height:10px;}/*滚动条尺寸*/
	.dialog-box .report::-webkit-scrollbar-button{display:none;}
	.dialog-box .report::-webkit-scrollbar-track{background:#424f63;}/*滚动条背景*/
	.dialog-box .report::-webkit-scrollbar-thumb{background:#65cea7;}/*滚动条*/
	
</style>
</head>
#parse ("common/main_header.htm")

<div class="content" style="background-color: #f5f5f5;">
	#set ($menuList = $session.getAttribute("menuList")) #set($num=0)
	<div class="left_nav" id="leftNav"
		style="height: 500px; overflow: auto;position:relative;">
		<div class="sidebar">
			<ul class="sidelist">
				#foreach($menu in $!menuList) #if($menu.layer==2 && $menu.url &&
				$menu.url != "" ) #if($menu.id == "020000" )
				<li class="category1 select"><a href="${contextPath}$menu.url"
					target="backStageManagement"
					style="*padding-left: 0px; font-size: 14px;"> <span class=""><img
							src="${uicasePath}/$menu.img" /> $menu.title</span></a></li> #else
				<li class="category1"><a href="${contextPath}$menu.url"
					target="backStageManagement"
					style="*padding-left: 0px; font-size: 14px;"> <span class=""><img
							src="${uicasePath}/$menu.img" /> $menu.title</span></a></li> #end
				#elseif($menu.layer==2) #if($num==1)
			</ul>
			</li> #set($num=0) #end
			<li class="category"><span class="list">$menu.title</span>
				#if($num==0)
				<ul>
					<div>
						#set($num=1) #end #else
						<li class="sub"><a href="${contextPath}$menu.url"
							target="backStageManagement" title='$menu.title'>$menu.title</a>
						</li> #end #end #if($num==1)
					</div>
				</ul> #set($num=0) #end</li>
			</ul>
		</div>
	</div>
	<div class="content_main" style="background-color: #fff;position:relative;">
		<div class="contentinner_ifram">
			<iframe id="backStageManagement" width="90%" height="556"
				frameborder="0" marginheight="0" marginwidth="0"
				src="${contextPath}/home.page" name="backStageManagement"
				allowtransparency="true"
				onload="this.height=this.contentWindow.document.body.scrollHeight"
				style="height: 510px; width: 1146px; overflow: visible;"></iframe>
		</div>
	</div>
	
	<div id="ltjl">
		<div class="pull-right" onclick="hideLtjl()"><img src="${uicasePath}/images/right.png"/></div>
		<h1>在线审批记录 <input type="button" id="pre"  value="上一页" class="fanye"/> <input type="button" id="nex" value="下一页" class="fanye"/></h1>
		<!--  <div class="jlSearch">
			<input type="text" style=""/>
			<span></span>
		</div>-->
		<div class="spjl" >
			<!-- <div>
				<p>李丽&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>
			<div class="own">
				<p>我自己&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>			
			<div class="own">
				<p>我自己&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>					
			<div class="own">
				<p>我自己&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p style="color:#71aaf7">上传图片</p>
				<p>
					<img src="${uicasePath}/images/img_01.png"/>
					<img src="${uicasePath}/images/img_01.png"/>
					<img src="${uicasePath}/images/img_01.png"/>
					<img src="${uicasePath}/images/img_01.png"/>
				</p>
			</div>
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>				
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>			
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p>审批记录审批记录审批记录审批记录</p>
			</div>			
			<div>
				<p>王丽君&nbsp;（2017-04-25&nbsp;10:00）</p>
				<p style="color:#4dffba">上传语音</p>
				<p><img src="${uicasePath}/images/music.png"/></p>
			</div>	 -->
    		
		</div>
		<div class="fb">
	        <textarea name="message" id ="message" placeholder="输入聊天内容"></textarea>
	        <object id="base64-swf" width="24" height="24"
				type="application/x-shockwave-flash" data="${contextPath}/common/js/common/Mybutton2.swf">
				<param name="movie" value="${contextPath}/common/js/common/Mybutton2.swf" />
			</object>
	        <!--  <a href="javascript:;" class="image" onclick="sendphoto()"></a><a href="javascript:;" class="image music"></a> -->
			<span id ="send" >发送</span>
		</div>
		
		
		
		<div id="scDiv">
		     <input type="hidden"  id="loginUserId"  value="$!user.id"/>
		     <input type="text"    id="totalCount"   value="$!count"/>    <!-- 总数 -->
      		 <input type="text"    id="rowNum" 		 value="$!currentPage"/>    <!-- currentpage -->
      		 <input type="text"    id="appId" 		 value=""/>
		</div>
	</div>
	
</div>

<div class="dialog" >
		<div class="background">			
			<form class="dialog-box" style="width: 50%; margin-top: 2%;">
			<h5>查看大图</h5>
			<span class="closebtn" onclick='$(".dialog").hide();'></span>
			<div class="dialog-content">
			<img id="bigImg" style="width: 100%;height: 480px;/>
			</div>
			<p class="button"></p>
			</form>
		</div>
</div>

#parse ("common/footer.htm")

<script type="text/javascript">
	function showBig(obj){
		$(".dialog").show();
		$("#bigImg").attr("src",$(obj).attr("src"))
	}
	function setImage(obj){
		if($(obj).val()!=""){
			$(obj).parent().html("<img src='${uicasePath}/images/img_01.png'/>")
			$("#tp").append("&nbsp;<a href='javascript:;' class='image'><input type='file' onchange='setImage(this)'/></a>&nbsp;");
		}
	}
	function setMusic(obj){
		if($(obj).val()!=""){
			$(obj).parent().html("<img src='${uicasePath}/images/img_01.png'/>")
			$("#yp").append("&nbsp;<a href='javascript:;' class='image'><input type='file' onchange='setImage(this)'/></a>&nbsp;");
		}
		
	}
	var menu = new ULMenu("#leftNav");
	var currentWindow = new WindowInfo(menu);
	$(document).ready(function() {
		currentWindow.init();
		var weekDate = new Date();
		var weekDayTextStr = "星期";
		weekDayTextStr += "天一二三四五六".charAt(weekDate.getDay());
		document.getElementById("weekDayText").innerHTML = weekDayTextStr;

		showDate();
		
	})
	function hideLtjl(){//隐藏在线审批记录
		$(".left_nav").animate({left:"0px"},200);
		$(".content_main").animate({left:"0px"},200);
		
		$("#backStageManagement").contents().find(".content_main").css("width","97.5%")
		$("#ltjl").animate({right:"-300px"},200);
		
	}
</script>

<script type="text/javascript" src="${contextPath}/common/js/common/swfobject.js"></script>
<script type="text/javascript" src="${contextPath}/common/js/common/web_socket.js"></script>
<script type="text/javascript" src="${contextPath}/common/js/common/jquery.json-2.3.js"></script>
<script type="text/javascript">
		$(document).keydown(function(event){
			if(event.keyCode==13){
			$("#send").click();
			}
	    });

		WEB_SOCKET_SWF_LOCATION = "${contextPath}/common/js/common/WebSocketMain.swf";
		var ws;
		var textarea;
		var base64swf;
		var imgview;
		var img;
	    var base64Data = "", base64Type = "";
		
		$(document).ready(function() {
			ws = new WebSocket("ws://61.34.0.31:10088/ws");
			ws.onopen = function() {
				var ta = document.getElementById('responseText');
			};
			ws.onmessage = function(e) {
	            	var ta = document.getElementById('responseText');
	            	var arr = e.data.split(' ');
	            	var name =arr[0];
	            	var time =arr[1]+" "+arr[2];
	            	var content =arr[3];
	            	var ptype =arr[4];
	            	if(ptype == '2'){
	            		var url = "/intopieces/addIntopieces/startExcel.json?id="+arr[6];
	            		var src = "${contextPath}"+url;
	            		/* var type =arr[5];
	            		var img1 = "data:image/" + type + ";base64," + content;
	        			$(".spjl").append("<div id='base64-imgview'><p>"+name+"&nbsp;&nbsp;"+time+"&nbsp;:</p><p><img id='base64-img' onclick ='showBig(this)' style='height:100px;width:100px;' src ='"+img1+"'/></p></div>"); */
	            		$(".spjl").append("<div id='base64-imgview'><p>"+name+"&nbsp;&nbsp;"+time+"&nbsp;:</p><p><img id='base64-img' onclick ='showBig(this)' style='height:100px;width:100px;' src ='"+src+"'/></p></div>");
	            	}else{
	            		$(".spjl").append("<div><p>"+name+"&nbsp;&nbsp;"+time+"&nbsp;:</p><p>"+content+"</p></div>");
	            	}
	            	// 焦点始终在最后一行
	            	var hei=$(".spjl").height(); 
	            	$(".spjl").scrollTop(hei); 
			};
			ws.onclose = function() {
				var ta = document.getElementById('responseText');
			};
			ws.onerror = function() {
				var ta = document.getElementById('responseText');
			};
			
			textarea = $("#base64-textarea");
			base64swf = $("#base64-swf").get(0);
			imgview = $("#base64-imgview");
			img = $("#base64-img");
			
		   	base64Data = "";
		   	base64Type = "";
		});
		

		function onSend(message) {
			if (ws.readyState == WebSocket.OPEN) {
				message = $("#loginUserId").val()+$("#appId").val()+ message;
				ws.send(message);
			} else {
				window.top.Dialog.message("连接关闭");
			}
		}
		
		
		// send text 
		document.getElementById('send').onclick=function(){
			if($("#message").val()== ''){
				window.top.Dialog.message("发送内容不能为空,请重新输入");
				return;
			}
			// send
			onSend($("#message").val());
			$("#message").val("");
		}
		
		window.showBase64 = function(name,type,data){
			base64Type = type;
			base64Data = data;
			//send 图片流
			onSend("base64"+type+data);
		};
		
		window.onFlashError = function(error){
			window.top.Dialog.message(error);
		};
		
		
		// 翻页
		$("#pre").click(function() {
			var currentPage = Number($("#rowNum").val()) - Number(1);
			if(Number(currentPage)<=0){
				$("#pre").hide();
				$("#nex").show();
			    return;
			}
			var appId = $("#appId").val();
			var tmp="";
			var url ="${contextPath}/intopieces/addIntopieces/browseChatMsg.json?currentPage="+currentPage+"&appId="+appId;
			$.ajax({
				url:url,
				type: "GET",
				dataType:'json',
				success: function (json) {
					obj = $.evalJSON(json);
					$("#rowNum").val(obj.rownum);
					$("#totalCount").val(obj.totalCount);
					
					for(var i = 0;i<obj.result.length;i++){
						tmp=tmp+"<div><p>"+obj.result[i].createdBy+"&nbsp;&nbsp;"+obj.result[i].createdTime+"&nbsp;:</p><p>"+obj.result[i].msgContent+"</p></div>";
					}
					$(".spjl").html(tmp);
				}
			})
		});
		
		
		$("#nex").click(function() {
		    var currentPage = Number($("#rowNum").val()) + Number(1);
		    if(Number(currentPage)>=Number($("#totalCount").val())/Number(10) + Number(1)){
		    	$("#nex").hide();
		    	$("#pre").show();
		    	return;
		    } 
		    
		    var appId = $("#appId").val();
		    var tmp="";
		    var url ="${contextPath}/intopieces/addIntopieces/browseChatMsg.json?currentPage="+currentPage+"&appId="+appId;
			$.ajax({
				url:url,
				type: "GET",
				dataType:'json',
				success: function (json) {
					obj = $.evalJSON(json);
					$("#rowNum").val(obj.rownum);
					$("#totalCount").val(obj.totalCount);
					for(var i = 0;i<obj.result.length;i++){
						tmp=tmp+"<div><p>"+obj.result[i].createdBy+"&nbsp;&nbsp;"+obj.result[i].createdTime+"&nbsp;:</p><p>"+obj.result[i].msgContent+"</p></div>";
					}
					$(".spjl").html(tmp);
				}
			})
		});
		
</script>

</body>
</html>