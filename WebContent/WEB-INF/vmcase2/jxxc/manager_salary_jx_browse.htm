#parse ("common/iframe_page_header.htm")
<body>
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">客户经理每月工资信息</div>
      </div>
      <div class="inquiry">
        <div class="search_tag">#i18n("label.browse.filter")</div>
        <div class="search">
          <form id="submitForm" >
            <ul>
              <li>
                <span>客户经理：<input type="text" id="managerName" name="managerName" value="" maxlength="50"/></span>
              </li>
              <li>
                <span>所属机构：<input type="text" id="organName" name="organName" value="" maxlength="50"/></span>
              </li>
              <li>
	          	<span>日期:&nbsp;<input type="text" id ="date" name="date" value='$!date.format("yyyy-MM-dd",$!result.filter.startDate)' 
	          		onmouseover="_calendar()" readonly="readonly" maxlength="30"/></span>
              </li>
              <li class="search_button">
                <input id="id_browse_button" type="button" value="#i18n('button.browse')" class="search_button_inquiry"
                  title="#i18n('button.browse.hint')" style="height: 26px; line-height: 24px;" />
              </li>
            </ul>
          </form>
        </div>
        <div id="topDiv" class="inquiry_list inquiry_top">
          <table>
            <colgroup>
              <col width="5%" />
              <col width="5%" />
              <col width="8%" />
              <col width="5%" />
              <col width="5%" />
            </colgroup>
            <tr class="title">
              <th nowrap="nowrap">年份</th>
              <th nowrap="nowrap">月份</th>
              <th nowrap="nowrap">所属机构</th>
              <th nowrap="nowrap">客户经理</th>
              <th nowrap="nowrap">基本工资</th>
            </tr>
          </table>
        </div>
        <div id="downDiv" class="inquiry_list inquiry_down">
          <table>
            <colgroup>
              <col width="5%" />
              <col width="5%" />
              <col width="8%" />
              <col width="5%" />
              <col width="5%" />
            </colgroup>
            #foreach ($managerSalary in $result.items)
            <tr>
              <td nowrap="nowrap">$!managerSalary.year</td>
              <td nowrap="nowrap">$!managerSalary.month</td>
              <td nowrap="nowrap">$!managerSalary.shortName</td>
              <td nowrap="nowrap">$!managerSalary.managerName</td>
              <td nowrap="nowrap">$format.formatNumber(2, $!managerSalary.basePay)</td>
            </tr>
            #end
          </table>
        </div>
      </div>
      <div class="pagebar">
        <div class="controlbtn">
           <input id="id_genertae_button" type="button" value="生成数据" class="search_button_inquiry"
                  title="生成数据" style="height: 26px; line-height: 24px;" />
           <input id="id_export_button" type="button" value="导出" class="search_button_inquiry"
                  title="导出" style="height: 26px; line-height: 24px;" />
           <input id="id_export_button" type="button" value="打印" class="search_button_inquiry"
                  title="打印" style="height: 26px; line-height: 24px;" />
        </div>
        #parse ("common/pagination.htm")
        <div class="clear"></div>
      </div>
    </div>
  </div>
</body>
<script language="javascript" type="text/javascript">
	var layout = new TableLayout(2);
	window.top.currentWindow.setLayout(layout);

	$(document).ready(function() {
		var opsObj = new Object();
		opsObj.formObj = $("#submitForm");
		opsObj.createUrl = "${modulePath}/create.page";
		opsObj.displayUrl = "${modulePath}/display.page";
		opsObj.changeUrl = "${modulePath}/change.page";
		opsObj.deleteUrl = "${modulePath}/delete.json";
		opsObj.browseUrl = "${modulePath}/browse.page";
		opsObj.exportUrl = "${modulePath}/exportData.json";
		
		//浏览
		if (opsObj.browseUrl) {
			 $("#id_browse_button").click(function() {
		            var url = opsObj.browseUrl;
	                document.getElementById("submitForm").action = url;
	                document.getElementById("submitForm").submit();
		        });
		}
		
		//生成每月工资数据
		$("#id_genertae_button").click(function() {
			
	    	if($("#query_date").val() == "" || $("#query_date").val() == null){
	    		Dialog.message("请输入年份和月份");
	    	}else{
	    		Dialog.load();
				$.ajax({
					type:'GET',
					url:"${modulePath}/generateData.json",
					data:{'year': year, "month": month},
					success:function(msg){
						Dialog.closeLoad();
						if(msg.success == true){
							Dialog.message("成功");
							window.location.href="${modulePath}/browse.page?year="+year+"&month="+month;
						}else{
							Dialog.message("失败");
						}
						
					}
				});
	    	}
	    });
		
		//导出
		$("#id_export_button").click(function() {
			var year = $.trim($("#year").val());
			var month = $.trim($("#month").val());
	    	if(year == "" || month == ""){
	    		Dialog.message("请输入年份和月份");
	    	}else{
	    		var url = opsObj.exportUrl;
            	document.getElementById("submitForm").action = url;
            	document.getElementById("submitForm").submit();
	    	}
	    });
		
	});
</script>
#parse ("common/iframe_page_footer.htm")
